<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Corels vs Random Forest • tidycorels</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Corels vs Random Forest">
<meta property="og:description" content="tidycorels">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tidycorels</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/diabetes_example.html">Corels vs Random Forest</a>
    </li>
    <li>
      <a href="../articles/german_credit_data_example.html">Corels vs XGBoost</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/billster45/tidycorels">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="diabetes_example_files/kePrint-0.0.1/kePrint.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Corels vs Random Forest</h1>
            
            <h4 class="date">2020-07-26</h4>
      
      
      <div class="hidden name"><code>diabetes_example.Rmd</code></div>

    </div>

    
    
<div id="summary" class="section level1">
<h1 class="hasAnchor">
<a href="#summary" class="anchor"></a>Summary</h1>
<p>The performance of <a href="https://corels.eecs.harvard.edu/">Corels</a> on test data is compared to <a href="http://www.rebeccabarter.com/blog/2020-03-25_machine_learning/">Rebecca Barter’s</a> tidymodels walkthrough applying a random forest model.</p>
<p>The accuarcy of Corels on test data of 75% is the same as Rebbeca’s random forest example and similar to that achieved by popular <a href="https://www.kaggle.com/uciml/pima-indians-diabetes-database/kernels">Kaggle notebooks</a>. Though Corels has the advantage of readable rules.</p>
</div>
<div id="background" class="section level1">
<h1 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h1>
<blockquote>
<p>Corels are <a href="https://corels.eecs.harvard.edu/">‘Certifiably Optimal RulE ListS’</a>. They are short and simple human <a href="https://arxiv.org/pdf/1704.01701.pdf">interpretable rule lists</a> created on categorical data.</p>
</blockquote>
<p>This analysis compares the performance of a simple Corels rule set to a randome forest on the <a href="https://www.kaggle.com/uciml/pima-indians-diabetes-database">Pima Indians Diabetes datase</a>.</p>
</div>
<div id="pima-indians-diabetes-data" class="section level1">
<h1 class="hasAnchor">
<a href="#pima-indians-diabetes-data" class="anchor"></a>Pima Indians diabetes data</h1>
<p>In this example, we re-use the exact <code>recipes</code> data preparation steps from the excellent tidymodels walkthrough by <a href="http://www.rebeccabarter.com/blog/2020-03-25_machine_learning/">Rebecca Barter</a></p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidymodels</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">corels</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidycorels</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">kableExtra</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">easyalluvial</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">parcats</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">formattable</span>)

<span class="no">kable_table</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">table</span>, <span class="no">title</span>) {
  <span class="kw pkg">kableExtra</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/reexports.html">kable</a></span>(<span class="no">table</span>, <span class="kw">caption</span> <span class="kw">=</span> <span class="no">title</span>) <span class="kw">%&gt;%</span>
    <span class="kw pkg">kableExtra</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span>(
      <span class="kw">latex_options</span> <span class="kw">=</span> <span class="st">"hold_position"</span>,
      <span class="kw">full_width</span> <span class="kw">=</span> <span class="no">F</span>,
      <span class="kw">bootstrap_options</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"striped"</span>, <span class="st">"condensed"</span>),
      <span class="kw">position</span> <span class="kw">=</span> <span class="st">"left"</span>
    )
}

<span class="co"># load the Pima Indians dataset from the mlbench dataset</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">mlbench</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">PimaIndiansDiabetes</span>)
<span class="no">diabetes_orig</span> <span class="kw">&lt;-</span> <span class="no">PimaIndiansDiabetes</span>

<span class="no">diabetes_clean</span> <span class="kw">&lt;-</span> <span class="no">diabetes_orig</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_at</a></span>(
    <span class="fu">vars</span>(<span class="no">triceps</span>, <span class="no">glucose</span>, <span class="no">pressure</span>, <span class="no">insulin</span>, <span class="no">mass</span>),
    <span class="kw">function</span>(<span class="no">.var</span>) {
      <span class="fu">if_else</span>(<span class="kw">condition</span> <span class="kw">=</span> (<span class="no">.var</span> <span class="kw">==</span> <span class="fl">0</span>), <span class="co"># if true (i.e. the entry is 0)</span>
        <span class="kw">true</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="fl">NA</span>), <span class="co"># replace the value with NA</span>
        <span class="kw">false</span> <span class="kw">=</span> <span class="no">.var</span> <span class="co"># otherwise leave it as it is</span>
      )
    }
  )

<span class="fu">kable_table</span>(<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">diabetes_clean</span>, <span class="fl">5</span>), <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Pima Indians Dataset"</span>)</pre></body></html></div>
<table class="table table table-striped table-condensed">
<caption>
Pima Indians Dataset
</caption>
<thead><tr>
<th style="text-align:right;">
pregnant
</th>
<th style="text-align:right;">
glucose
</th>
<th style="text-align:right;">
pressure
</th>
<th style="text-align:right;">
triceps
</th>
<th style="text-align:right;">
insulin
</th>
<th style="text-align:right;">
mass
</th>
<th style="text-align:right;">
pedigree
</th>
<th style="text-align:right;">
age
</th>
<th style="text-align:left;">
diabetes
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
148
</td>
<td style="text-align:right;">
72
</td>
<td style="text-align:right;">
35
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
33.6
</td>
<td style="text-align:right;">
0.627
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:left;">
pos
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
66
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
26.6
</td>
<td style="text-align:right;">
0.351
</td>
<td style="text-align:right;">
31
</td>
<td style="text-align:left;">
neg
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
183
</td>
<td style="text-align:right;">
64
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
23.3
</td>
<td style="text-align:right;">
0.672
</td>
<td style="text-align:right;">
32
</td>
<td style="text-align:left;">
pos
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
89
</td>
<td style="text-align:right;">
66
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
94
</td>
<td style="text-align:right;">
28.1
</td>
<td style="text-align:right;">
0.167
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:left;">
neg
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
137
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
35
</td>
<td style="text-align:right;">
168
</td>
<td style="text-align:right;">
43.1
</td>
<td style="text-align:right;">
2.288
</td>
<td style="text-align:right;">
33
</td>
<td style="text-align:left;">
pos
</td>
</tr>
</tbody>
</table>
<p>The Pima Indians diabetes data set is split into train and test datasets.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">234589</span>)
<span class="no">diabetes_split</span> <span class="kw">&lt;-</span> <span class="kw pkg">rsample</span><span class="kw ns">::</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html">initial_split</a></span>(<span class="no">diabetes_clean</span>,<span class="kw">prop</span> <span class="kw">=</span> <span class="fl">3</span> / <span class="fl">4</span>)

<span class="no">diabetes_train</span> <span class="kw">&lt;-</span> <span class="kw pkg">rsample</span><span class="kw ns">::</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html">training</a></span>(<span class="no">diabetes_split</span>)
<span class="no">diabetes_test</span> <span class="kw">&lt;-</span> <span class="kw pkg">rsample</span><span class="kw ns">::</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html">testing</a></span>(<span class="no">diabetes_split</span>)

<span class="no">diabetes_cv</span> <span class="kw">&lt;-</span> <span class="fu">vfold_cv</span>(<span class="no">diabetes_train</span>)</pre></body></html></div>
</div>
<div id="prepare-dataframe-for-corels" class="section level1">
<h1 class="hasAnchor">
<a href="#prepare-dataframe-for-corels" class="anchor"></a>Prepare dataframe for Corels</h1>
<p>We now apply the same <code>recipe</code> steps as Rebecca, but with additional step to <a href="https://recipes.tidymodels.org/reference/step_discretize.html">discretise</a> the continuous variables, then each categorsied value is given its own 0/1 binary column using <a href="https://recipes.tidymodels.org/reference/step_dummy.html"><code><a href="https://recipes.tidymodels.org/reference/step_dummy.html">recipes::step_dummy()</a></code></a>. This is sometimes called one-hot encoding.</p>
<p>Finally, Corels requires the label column (<code>diabetes</code>) to be split into two columns representing each class. First we ensure the values in the label are 0 and 1 instead of words (using <code><a href="https://recipes.tidymodels.org/reference/step_integer.html">recipes::step_integer()</a></code>), then use <a href="https://recipes.tidymodels.org/reference/step_dummy.html"><code><a href="https://recipes.tidymodels.org/reference/step_dummy.html">recipes::step_dummy()</a></code></a> to create the two label columns.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">diabetes_corels_recipe</span> <span class="kw">&lt;-</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html">recipe</a></span>(<span class="no">diabetes</span> ~ <span class="no">pregnant</span> + <span class="no">glucose</span> + <span class="no">pressure</span> + <span class="no">triceps</span> + <span class="no">insulin</span> + <span class="no">mass</span> + <span class="no">pedigree</span> + <span class="no">age</span>,
                  <span class="kw">data</span> <span class="kw">=</span> <span class="no">diabetes_train</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/step_normalize.html">step_normalize</a></span>(<span class="fu">all_numeric</span>()) <span class="kw">%&gt;%</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/step_knnimpute.html">step_knnimpute</a></span>(<span class="fu">all_predictors</span>()) <span class="kw">%&gt;%</span>
  <span class="co"># 1 discretise continous variables into bins</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/step_discretize.html">step_discretize</a></span>(-<span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_outcomes</a></span>(), <span class="kw">min_unique</span> <span class="kw">=</span> <span class="fl">1</span>) <span class="kw">%&gt;%</span>
  <span class="co"># 2 convert each value of each predictor into its own 0/1 binary column</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/step_mutate_at.html">step_mutate_at</a></span>(<span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_predictors</a></span>(), <span class="kw">fn</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(~ <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">.</span>))) <span class="kw">%&gt;%</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/step_dummy.html">step_dummy</a></span>(<span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_predictors</a></span>(), <span class="kw">one_hot</span> <span class="kw">=</span> <span class="fl">TRUE</span>) <span class="kw">%&gt;%</span>
  <span class="co"># 3 convert each value of the outcome column into its own 0/1 binary column</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/step_integer.html">step_integer</a></span>(<span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_outcomes</a></span>(), <span class="kw">zero_based</span> <span class="kw">=</span> <span class="fl">TRUE</span>) <span class="kw">%&gt;%</span> <span class="co"># ensure outcome is 0/1 rather than words</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/step_mutate_at.html">step_mutate_at</a></span>(<span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_outcomes</a></span>(), <span class="kw">fn</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(~ <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">.</span>))) <span class="kw">%&gt;%</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/step_dummy.html">step_dummy</a></span>(<span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_outcomes</a></span>(), <span class="kw">one_hot</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="co"># Train the data recipe on the training data</span>
<span class="no">diabetes_trained_rec</span> <span class="kw">&lt;-</span> <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/prep.html">prep</a></span>(<span class="no">diabetes_corels_recipe</span>,
                                      <span class="kw">training</span> <span class="kw">=</span> <span class="no">diabetes_train</span>,
                                      <span class="kw">retain</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="co"># Extract the train data with recipe applied (juice), and the same recipe applied to the test data (bake)</span>
<span class="no">diabetes_train_preprocessed</span> <span class="kw">&lt;-</span> <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/juice.html">juice</a></span>(<span class="no">diabetes_trained_rec</span>)
<span class="no">diabetes_test_preprocessed</span> <span class="kw">&lt;-</span> <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/bake.html">bake</a></span>(<span class="no">diabetes_trained_rec</span>,
                                            <span class="kw">new_data</span> <span class="kw">=</span> <span class="no">diabetes_test</span>)

<span class="co"># View the proccessed trained data</span>
<span class="fu">kable_table</span>(<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">diabetes_train_preprocessed</span>, <span class="fl">5</span>), <span class="kw">title</span> <span class="kw">=</span> <span class="st">"diabetes training data preprocessed"</span>)</pre></body></html></div>
<table class="table table table-striped table-condensed">
<caption>
diabetes training data preprocessed
</caption>
<thead><tr>
<th style="text-align:right;">
pregnant_bin_missing
</th>
<th style="text-align:right;">
pregnant_bin1
</th>
<th style="text-align:right;">
pregnant_bin2
</th>
<th style="text-align:right;">
pregnant_bin3
</th>
<th style="text-align:right;">
pregnant_bin4
</th>
<th style="text-align:right;">
glucose_bin_missing
</th>
<th style="text-align:right;">
glucose_bin1
</th>
<th style="text-align:right;">
glucose_bin2
</th>
<th style="text-align:right;">
glucose_bin3
</th>
<th style="text-align:right;">
glucose_bin4
</th>
<th style="text-align:right;">
pressure_bin_missing
</th>
<th style="text-align:right;">
pressure_bin1
</th>
<th style="text-align:right;">
pressure_bin2
</th>
<th style="text-align:right;">
pressure_bin3
</th>
<th style="text-align:right;">
pressure_bin4
</th>
<th style="text-align:right;">
triceps_bin_missing
</th>
<th style="text-align:right;">
triceps_bin1
</th>
<th style="text-align:right;">
triceps_bin2
</th>
<th style="text-align:right;">
triceps_bin3
</th>
<th style="text-align:right;">
triceps_bin4
</th>
<th style="text-align:right;">
insulin_bin_missing
</th>
<th style="text-align:right;">
insulin_bin1
</th>
<th style="text-align:right;">
insulin_bin2
</th>
<th style="text-align:right;">
insulin_bin3
</th>
<th style="text-align:right;">
insulin_bin4
</th>
<th style="text-align:right;">
mass_bin_missing
</th>
<th style="text-align:right;">
mass_bin1
</th>
<th style="text-align:right;">
mass_bin2
</th>
<th style="text-align:right;">
mass_bin3
</th>
<th style="text-align:right;">
mass_bin4
</th>
<th style="text-align:right;">
pedigree_bin_missing
</th>
<th style="text-align:right;">
pedigree_bin1
</th>
<th style="text-align:right;">
pedigree_bin2
</th>
<th style="text-align:right;">
pedigree_bin3
</th>
<th style="text-align:right;">
pedigree_bin4
</th>
<th style="text-align:right;">
age_bin_missing
</th>
<th style="text-align:right;">
age_bin1
</th>
<th style="text-align:right;">
age_bin2
</th>
<th style="text-align:right;">
age_bin3
</th>
<th style="text-align:right;">
age_bin4
</th>
<th style="text-align:right;">
diabetes_X0
</th>
<th style="text-align:right;">
diabetes_X1
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
</div>
<div id="run-tidycorels" class="section level1">
<h1 class="hasAnchor">
<a href="#run-tidycorels" class="anchor"></a>Run tidycorels</h1>
<p>We can now run <code><a href="../reference/tidy_corels.html">tidycorels::tidy_corels()</a></code> function on the prepared diabetes training data.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">diabetes_train_model</span> <span class="kw">&lt;-</span>
  <span class="kw pkg">tidycorels</span><span class="kw ns">::</span><span class="fu"><a href="../reference/tidy_corels.html">tidy_corels</a></span>(
    <span class="kw">df</span> <span class="kw">=</span> <span class="no">diabetes_train_preprocessed</span>,
    <span class="kw">label_cols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"diabetes_X0"</span>, <span class="st">"diabetes_X1"</span>),
    <span class="kw">value_delim</span> <span class="kw">=</span> <span class="st">"_"</span>,
    <span class="kw">run_bfs</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
    <span class="kw">calculate_size</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
    <span class="kw">run_curiosity</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
    <span class="kw">regularization</span> <span class="kw">=</span> <span class="fl">0.01</span>,
    <span class="kw">curiosity_policy</span> <span class="kw">=</span> <span class="fl">3</span>,
    <span class="kw">map_type</span> <span class="kw">=</span> <span class="fl">1</span>
  )</pre></body></html></div>
<p>Here are the Corels rules for the diabetes data.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">diabetes_train_model</span>$<span class="no">corels_console_output</span>[<span class="fl">4</span>:<span class="fl">10</span>]
<span class="co">#&gt; [1] "OPTIMAL RULE LIST"                             </span>
<span class="co">#&gt; [2] "if ({age:bin1}) then ({diabetes:X0})"          </span>
<span class="co">#&gt; [3] "else if ({glucose:bin4}) then ({diabetes:X1})" </span>
<span class="co">#&gt; [4] "else if ({insulin:bin1}) then ({diabetes:X0})" </span>
<span class="co">#&gt; [5] "else if ({pedigree:bin1}) then ({diabetes:X0})"</span>
<span class="co">#&gt; [6] "else if ({triceps:bin4}) then ({diabetes:X1})" </span>
<span class="co">#&gt; [7] "else ({diabetes:X0})"</span></pre></body></html></div>
<p>And here are those rules converted to data.table code.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">diabetes_train_model</span>$<span class="no">corels_rules_DT</span>
<span class="co">#&gt; [1] "DT[,corels_label := fifelse( `age_bin1` == 1, 0,fifelse( `glucose_bin4` == 1, 1,fifelse( `insulin_bin1` == 1, 0,fifelse( `pedigree_bin1` == 1, 0,fifelse( `triceps_bin4` == 1, 1,0)))))]"</span></pre></body></html></div>
<p>A dataframe of just the true label, the columns used in the Corels rules, and the Corels predictions is also available. The columns have been ordered for you to work well in an <a href="https://github.com/erblast/easyalluvial/blob/master/README.md">alluvial</a> plot.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">diabetes_train_model</span>$<span class="no">alluvial_df</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">easyalluvial</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/easyalluvial/man/alluvial_wide.html">alluvial_wide</a></span>(<span class="kw">stratum_width</span> <span class="kw">=</span> <span class="fl">0.2</span>) +
  <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span>() +
  <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(
    <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Corels if-then-else logic"</span>,
    <span class="kw">subtitle</span> <span class="kw">=</span> <span class="st">" From truth (far left column) to Corels classification (far right column)"</span>
  )</pre></body></html></div>
<p><img src="diabetes_example_files/figure-html/unnamed-chunk-7-1.png" width="80%"></p>
</div>
<div id="performance-on-test-data" class="section level1">
<h1 class="hasAnchor">
<a href="#performance-on-test-data" class="anchor"></a>Performance on test data</h1>
<p>Next we use the function <code>tidycorels::corels_predict()</code> to apply the Corels rules created on the training data to the test data.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">diabetes_test_predict</span> <span class="kw">&lt;-</span>
  <span class="kw pkg">tidycorels</span><span class="kw ns">::</span><span class="fu"><a href="../reference/predict_corels.html">predict_corels</a></span>(
    <span class="kw">model</span> <span class="kw">=</span> <span class="no">diabetes_train_model</span>,
    <span class="kw">new_df</span> <span class="kw">=</span> <span class="no">diabetes_test_preprocessed</span>
  )</pre></body></html></div>
<p>We can now use the test data that has been labelled using the Corels rules to compare to the true labe with a confusion matrix and performance statistics.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">conf_matrix</span> <span class="kw">&lt;-</span>
  <span class="no">diabetes_test_predict</span>$<span class="no">new_df_labelled</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">yardstick</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/yardstick/man/conf_mat.html">conf_mat</a></span>(
    <span class="kw">truth</span> <span class="kw">=</span> <span class="st">"diabetes_X1"</span>,
    <span class="kw">estimate</span> <span class="kw">=</span> <span class="st">"corels_label"</span>
  )

<span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span>(<span class="no">conf_matrix</span>, <span class="st">"heatmap"</span>)</pre></body></html></div>
<p><img src="diabetes_example_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><html><body><pre class="r">
<span class="co"># https://github.com/tidymodels/yardstick/issues/160</span>
<span class="no">conf_matrix</span> <span class="kw">&lt;-</span>
  <span class="kw pkg">withr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/withr/man/with_options.html">with_options</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">yardstick.event_first</span> <span class="kw">=</span> <span class="fl">FALSE</span>),<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">conf_matrix</span>)) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">:::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">.estimate</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">.estimate</span>, <span class="kw">digits</span> <span class="kw">=</span> <span class="fl">3</span>)) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">.metric</span>, <span class="no">.estimate</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">.metric</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"accuracy"</span>,<span class="st">"bal_accuracy"</span>,<span class="st">"mcc"</span>,<span class="st">"precision"</span>, <span class="st">"recall"</span>, <span class="st">"f_meas"</span>))

<span class="no">conf_matrix</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">.estimate</span> <span class="kw">=</span> <span class="kw pkg">formattable</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/formattable/man/color_tile.html">color_tile</a></span>(<span class="st">"white"</span>, <span class="st">"orange"</span>)(<span class="no">.estimate</span>)) <span class="kw">%&gt;%</span>
  <span class="kw pkg">kableExtra</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/reexports.html">kable</a></span>(<span class="kw">escape</span> <span class="kw">=</span> <span class="no">F</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">kableExtra</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span>(<span class="st">"hover"</span>, <span class="kw">full_width</span> <span class="kw">=</span> <span class="no">F</span>)</pre></body></html></div>
<table class="table table table-hover">
<thead><tr>
<th style="text-align:left;">
.metric
</th>
<th style="text-align:left;">
.estimate
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
accuracy
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffa500">0.745</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
mcc
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffffff">0.439</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
bal_accuracy
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffae19">0.714</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
precision
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffbb40">0.667</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
recall
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffcf78">0.600</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
f_meas
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffc65e">0.632</span>
</td>
</tr>
</tbody>
</table>
<p>The accuracy achieved by Corels on the unseen test data is 0.745. This is the same accuracy the random forest reached in Rebbeca’s example. In contrast, Corels rules are easy to read and visualise with an alluvial plot. For example, below if we follow one green path through the Corels rules where diabetes was correctly labelled. We can see they are:</p>
<ol style="list-style-type: decimal">
<li>in older age groups (age_bin1 = 0)</li>
<li>have the highest blood glucose concentraion (glucose_bin4 = 1),</li>
<li>have insulin that is one of the three highest bins (insulin_bin1 = 0),</li>
<li>their pedigree (family history) is in one of the three highest value bins, (pedigree_bin1 = 0) and</li>
<li>they are in the highest triceps bin (skin fold thickness) (triceps_bin4 = 0).</li>
</ol>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">diabetes_test_predict</span>$<span class="no">alluvial_df</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">easyalluvial</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/easyalluvial/man/alluvial_wide.html">alluvial_wide</a></span>(<span class="kw">stratum_width</span> <span class="kw">=</span> <span class="fl">0.2</span>) +
  <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span>() +
  <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(
    <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Corels if-then-else logic"</span>,
    <span class="kw">subtitle</span> <span class="kw">=</span> <span class="st">" From truth (far left column) to Corels classification (far right column)"</span>
  )</pre></body></html></div>
<p><img src="diabetes_example_files/figure-html/unnamed-chunk-10-1.png" width="80%"></p>
<p>Further, below we visualise the distribution of the raw values of each categorised bin used in each rule.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">diabetes_recipe_non_dummy</span> <span class="kw">&lt;-</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html">recipe</a></span>(<span class="no">diabetes</span> ~ <span class="no">pregnant</span> + <span class="no">glucose</span> + <span class="no">pressure</span> + <span class="no">triceps</span> + <span class="no">insulin</span> + <span class="no">mass</span> + <span class="no">pedigree</span> + <span class="no">age</span>,
                  <span class="kw">data</span> <span class="kw">=</span> <span class="no">diabetes_clean</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/step_normalize.html">step_normalize</a></span>(<span class="fu">all_numeric</span>()) <span class="kw">%&gt;%</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/step_knnimpute.html">step_knnimpute</a></span>(<span class="fu">all_predictors</span>()) <span class="kw">%&gt;%</span>
  <span class="co"># discretise numeric variables into bins</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/step_discretize.html">step_discretize</a></span>(-<span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_outcomes</a></span>(), <span class="kw">min_unique</span> <span class="kw">=</span> <span class="fl">1</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/step_mutate_at.html">step_mutate_at</a></span>(<span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_predictors</a></span>(), <span class="kw">fn</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(~ <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">.</span>))) <span class="kw">%&gt;%</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/step_mutate_at.html">step_mutate_at</a></span>(<span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_outcomes</a></span>(), <span class="kw">fn</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(~ <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">.</span>)))

<span class="no">diabetes_train_preprocessed</span> <span class="kw">&lt;-</span>
  <span class="no">diabetes_recipe_non_dummy</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/prep.html">prep</a></span>(<span class="no">diabetes_train</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/juice.html">juice</a></span>()

<span class="no">combined</span> <span class="kw">&lt;-</span> <span class="no">diabetes_train_preprocessed</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename_with</a></span>(<span class="no">toupper</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(<span class="no">diabetes_train</span>)

<span class="no">plot_fun</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">X</span>, <span class="no">Y</span>, <span class="no">bin</span>) {
  <span class="no">X</span> <span class="kw">&lt;-</span> <span class="kw pkg">rlang</span><span class="kw ns">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/nse-defuse.html">ensym</a></span>(<span class="no">X</span>)
  <span class="no">Y</span> <span class="kw">&lt;-</span> <span class="kw pkg">rlang</span><span class="kw ns">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/nse-defuse.html">ensym</a></span>(<span class="no">Y</span>)
  <span class="no">bin</span> <span class="kw">&lt;-</span> <span class="kw pkg">rlang</span><span class="kw ns">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/nse-defuse.html">ensym</a></span>(<span class="no">bin</span>)

  <span class="no">combined</span> <span class="kw">%&gt;%</span>
    <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu">aes</span>(
      <span class="kw">x</span> <span class="kw">=</span> !!<span class="no">X</span>,
      <span class="kw">y</span> <span class="kw">=</span> !!<span class="no">Y</span>
    )) +
    <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html">geom_violin</a></span>(<span class="kw">scale</span> <span class="kw">=</span> <span class="st">"count"</span>) +
    <span class="kw pkg">gghighlight</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/gghighlight/man/gghighlight.html">gghighlight</a></span>(!!<span class="no">X</span> <span class="kw">==</span> <span class="no">bin</span>) +
    <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span>()
}

<span class="no">p1</span> <span class="kw">&lt;-</span> <span class="fu">plot_fun</span>(<span class="kw">X</span> <span class="kw">=</span> <span class="no">AGE</span>, <span class="kw">Y</span> <span class="kw">=</span> <span class="no">age</span>, <span class="kw">bin</span> <span class="kw">=</span> <span class="no">bin1</span>)
<span class="no">p2</span> <span class="kw">&lt;-</span> <span class="fu">plot_fun</span>(<span class="kw">X</span> <span class="kw">=</span> <span class="no">GLUCOSE</span>, <span class="kw">Y</span> <span class="kw">=</span> <span class="no">glucose</span>, <span class="kw">bin</span> <span class="kw">=</span> <span class="no">bin4</span>)
<span class="no">p3</span> <span class="kw">&lt;-</span> <span class="fu">plot_fun</span>(<span class="kw">X</span> <span class="kw">=</span> <span class="no">INSULIN</span>, <span class="kw">Y</span> <span class="kw">=</span> <span class="no">insulin</span>, <span class="kw">bin</span> <span class="kw">=</span> <span class="no">bin1</span>)
<span class="no">p4</span> <span class="kw">&lt;-</span> <span class="fu">plot_fun</span>(<span class="kw">X</span> <span class="kw">=</span> <span class="no">PEDIGREE</span>, <span class="kw">Y</span> <span class="kw">=</span> <span class="no">pedigree</span>, <span class="kw">bin</span> <span class="kw">=</span> <span class="no">bin1</span>)
<span class="no">p5</span> <span class="kw">&lt;-</span> <span class="fu">plot_fun</span>(<span class="kw">X</span> <span class="kw">=</span> <span class="no">TRICEPS</span>, <span class="kw">Y</span> <span class="kw">=</span> <span class="no">triceps</span>, <span class="kw">bin</span> <span class="kw">=</span> <span class="no">bin4</span>)
<span class="kw pkg">cowplot</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/cowplot/man/plot_grid.html">plot_grid</a></span>(<span class="no">p1</span>, <span class="no">p2</span>, <span class="no">p3</span>, <span class="no">p4</span>, <span class="no">p5</span>)</pre></body></html></div>
<p><img src="diabetes_example_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>The plots from left to right highlight which bin is used in each Corels rule in the sequential order of the rules. The plot is created by combining the <a href="https://recipes.tidymodels.org/reference/step_discretize.html">discretised</a> and one-hot encoded data with the raw column values.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by The package maintainer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
