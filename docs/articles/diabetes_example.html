<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Corels vs Random Forest • tidycorels</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Corels vs Random Forest">
<meta property="og:description" content="tidycorels">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tidycorels</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/diabetes_example.html">Corels vs Random Forest</a>
    </li>
    <li>
      <a href="../articles/german_credit_data_example.html">Corels vs XGBoost</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/billster45/tidycorels">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="diabetes_example_files/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="diabetes_example_files/kePrint-0.0.1/kePrint.js"></script><script src="diabetes_example_files/htmlwidgets-1.5.1/htmlwidgets.js"></script><script src="diabetes_example_files/d3-4.5.0/d3.min.js"></script><script src="diabetes_example_files/sankey-1/sankey.js"></script><script src="diabetes_example_files/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><link href="diabetes_example_files/vis-4.20.1/vis.css" rel="stylesheet">
<script src="diabetes_example_files/vis-4.20.1/vis.min.js"></script><script src="diabetes_example_files/visNetwork-binding-2.0.9/visNetwork.js"></script><script src="diabetes_example_files/plotly.js-1.47.4/./plotly.min.js"></script><script src="diabetes_example_files/parcats-binding-0.0.1/parcats.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Corels vs Random Forest</h1>
            
            <h4 class="date">2020-08-17</h4>
      
      
      <div class="hidden name"><code>diabetes_example.Rmd</code></div>

    </div>

    
    
<div id="summary" class="section level1">
<h1 class="hasAnchor">
<a href="#summary" class="anchor"></a>Summary</h1>
<p>The performance of <a href="https://corels.eecs.harvard.edu/">Corels</a> on test data is compared to <a href="http://www.rebeccabarter.com/blog/2020-03-25_machine_learning/">Rebecca Barter’s</a> tidymodels walkthrough applying a random forest model.</p>
<p>The accuarcy of Corels on test data of 75% is the same as Rebbeca’s random forest example and similar to that achieved by popular <a href="https://www.kaggle.com/uciml/pima-indians-diabetes-database/kernels">Kaggle notebooks</a>. Though Corels has the advantage of readable rules.</p>
</div>
<div id="background" class="section level1">
<h1 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h1>
<blockquote>
<p>Corels are <a href="https://corels.eecs.harvard.edu/">‘Certifiably Optimal RulE ListS’</a>. They are short and simple human <a href="https://arxiv.org/pdf/1704.01701.pdf">interpretable rule lists</a> created on categorical data.</p>
</blockquote>
<p>This analysis compares the performance of a simple Corels rule set to a randome forest on the <a href="https://www.kaggle.com/uciml/pima-indians-diabetes-database">Pima Indians Diabetes datase</a>.</p>
</div>
<div id="pima-indians-diabetes-data" class="section level1">
<h1 class="hasAnchor">
<a href="#pima-indians-diabetes-data" class="anchor"></a>Pima Indians diabetes data</h1>
<p>In this example, we re-use the exact <code>recipes</code> data preparation steps from the excellent tidymodels walkthrough by <a href="http://www.rebeccabarter.com/blog/2020-03-25_machine_learning/">Rebecca Barter</a></p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidymodels</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">corels</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidycorels</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">kableExtra</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">easyalluvial</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">parcats</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">networkD3</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">formattable</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">visNetwork</span>)

<span class="no">kable_table</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">table</span>, <span class="no">title</span>) {
  <span class="kw pkg">kableExtra</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/reexports.html">kable</a></span>(<span class="no">table</span>, <span class="kw">caption</span> <span class="kw">=</span> <span class="no">title</span>) <span class="kw">%&gt;%</span>
    <span class="kw pkg">kableExtra</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span>(
      <span class="kw">latex_options</span> <span class="kw">=</span> <span class="st">"hold_position"</span>,
      <span class="kw">full_width</span> <span class="kw">=</span> <span class="no">F</span>,
      <span class="kw">bootstrap_options</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"striped"</span>, <span class="st">"condensed"</span>),
      <span class="kw">position</span> <span class="kw">=</span> <span class="st">"left"</span>
    )
}

<span class="co"># load the Pima Indians dataset from the mlbench dataset</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">mlbench</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">PimaIndiansDiabetes</span>)
<span class="no">diabetes_orig</span> <span class="kw">&lt;-</span> <span class="no">PimaIndiansDiabetes</span>

<span class="no">diabetes_clean</span> <span class="kw">&lt;-</span> <span class="no">diabetes_orig</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_at</a></span>(
    <span class="fu">vars</span>(<span class="no">triceps</span>, <span class="no">glucose</span>, <span class="no">pressure</span>, <span class="no">insulin</span>, <span class="no">mass</span>),
    <span class="kw">function</span>(<span class="no">.var</span>) {
      <span class="fu">if_else</span>(<span class="kw">condition</span> <span class="kw">=</span> (<span class="no">.var</span> <span class="kw">==</span> <span class="fl">0</span>), <span class="co"># if true (i.e. the entry is 0)</span>
        <span class="kw">true</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="fl">NA</span>), <span class="co"># replace the value with NA</span>
        <span class="kw">false</span> <span class="kw">=</span> <span class="no">.var</span> <span class="co"># otherwise leave it as it is</span>
      )
    }
  )

<span class="fu">kable_table</span>(<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">diabetes_clean</span>, <span class="fl">5</span>), <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Pima Indians Dataset"</span>)</pre></body></html></div>
<table class="table table table-striped table-condensed">
<caption>
Pima Indians Dataset
</caption>
<thead><tr>
<th style="text-align:right;">
pregnant
</th>
<th style="text-align:right;">
glucose
</th>
<th style="text-align:right;">
pressure
</th>
<th style="text-align:right;">
triceps
</th>
<th style="text-align:right;">
insulin
</th>
<th style="text-align:right;">
mass
</th>
<th style="text-align:right;">
pedigree
</th>
<th style="text-align:right;">
age
</th>
<th style="text-align:left;">
diabetes
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
148
</td>
<td style="text-align:right;">
72
</td>
<td style="text-align:right;">
35
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
33.6
</td>
<td style="text-align:right;">
0.627
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:left;">
pos
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
66
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
26.6
</td>
<td style="text-align:right;">
0.351
</td>
<td style="text-align:right;">
31
</td>
<td style="text-align:left;">
neg
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
183
</td>
<td style="text-align:right;">
64
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
23.3
</td>
<td style="text-align:right;">
0.672
</td>
<td style="text-align:right;">
32
</td>
<td style="text-align:left;">
pos
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
89
</td>
<td style="text-align:right;">
66
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
94
</td>
<td style="text-align:right;">
28.1
</td>
<td style="text-align:right;">
0.167
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:left;">
neg
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
137
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
35
</td>
<td style="text-align:right;">
168
</td>
<td style="text-align:right;">
43.1
</td>
<td style="text-align:right;">
2.288
</td>
<td style="text-align:right;">
33
</td>
<td style="text-align:left;">
pos
</td>
</tr>
</tbody>
</table>
<p>The Pima Indians diabetes data set is split into train and test datasets.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">234589</span>)
<span class="no">diabetes_split</span> <span class="kw">&lt;-</span> <span class="kw pkg">rsample</span><span class="kw ns">::</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html">initial_split</a></span>(<span class="no">diabetes_clean</span>,<span class="kw">prop</span> <span class="kw">=</span> <span class="fl">3</span> / <span class="fl">4</span>)

<span class="no">diabetes_train</span> <span class="kw">&lt;-</span> <span class="kw pkg">rsample</span><span class="kw ns">::</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html">training</a></span>(<span class="no">diabetes_split</span>)
<span class="no">diabetes_test</span> <span class="kw">&lt;-</span> <span class="kw pkg">rsample</span><span class="kw ns">::</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html">testing</a></span>(<span class="no">diabetes_split</span>)

<span class="no">diabetes_cv</span> <span class="kw">&lt;-</span> <span class="fu">vfold_cv</span>(<span class="no">diabetes_train</span>)</pre></body></html></div>
</div>
<div id="prepare-dataframe-for-corels" class="section level1">
<h1 class="hasAnchor">
<a href="#prepare-dataframe-for-corels" class="anchor"></a>Prepare dataframe for Corels</h1>
<p>We now apply the same <code>recipe</code> steps as Rebecca, but with additional step to <a href="https://recipes.tidymodels.org/reference/step_discretize.html">discretise</a> the continuous variables, then each categorsied value is given its own 0/1 binary column using <a href="https://recipes.tidymodels.org/reference/step_dummy.html"><code><a href="https://recipes.tidymodels.org/reference/step_dummy.html">recipes::step_dummy()</a></code></a>. This is sometimes called one-hot encoding.</p>
<p>Finally, Corels requires the label column (<code>diabetes</code>) to be split into two columns representing each class. First we ensure the values in the label are 0 and 1 instead of words (using <code><a href="https://recipes.tidymodels.org/reference/step_integer.html">recipes::step_integer()</a></code>), then use <a href="https://recipes.tidymodels.org/reference/step_dummy.html"><code><a href="https://recipes.tidymodels.org/reference/step_dummy.html">recipes::step_dummy()</a></code></a> to create the two label columns.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">diabetes_corels_recipe</span> <span class="kw">&lt;-</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html">recipe</a></span>(<span class="no">diabetes</span> ~ <span class="no">pregnant</span> + <span class="no">glucose</span> + <span class="no">pressure</span> + <span class="no">triceps</span> + <span class="no">insulin</span> + <span class="no">mass</span> + <span class="no">pedigree</span> + <span class="no">age</span>,
                  <span class="kw">data</span> <span class="kw">=</span> <span class="no">diabetes_train</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/step_normalize.html">step_normalize</a></span>(<span class="fu">all_numeric</span>()) <span class="kw">%&gt;%</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/step_knnimpute.html">step_knnimpute</a></span>(<span class="fu">all_predictors</span>()) <span class="kw">%&gt;%</span>
  <span class="co"># 1 discretise continous variables into bins</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/step_discretize.html">step_discretize</a></span>(-<span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_outcomes</a></span>(), <span class="kw">min_unique</span> <span class="kw">=</span> <span class="fl">1</span>) <span class="kw">%&gt;%</span>
  <span class="co"># 2 convert each value of each predictor into its own 0/1 binary column</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/step_mutate_at.html">step_mutate_at</a></span>(<span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_predictors</a></span>(), <span class="kw">fn</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(~ <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">.</span>))) <span class="kw">%&gt;%</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/step_dummy.html">step_dummy</a></span>(<span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_predictors</a></span>(), <span class="kw">one_hot</span> <span class="kw">=</span> <span class="fl">TRUE</span>) <span class="kw">%&gt;%</span>
  <span class="co"># 3 convert each value of the outcome column into its own 0/1 binary column</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/step_integer.html">step_integer</a></span>(<span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_outcomes</a></span>(), <span class="kw">zero_based</span> <span class="kw">=</span> <span class="fl">TRUE</span>) <span class="kw">%&gt;%</span> <span class="co"># ensure outcome is 0/1 rather than words</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/step_mutate_at.html">step_mutate_at</a></span>(<span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_outcomes</a></span>(), <span class="kw">fn</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(~ <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">.</span>))) <span class="kw">%&gt;%</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/step_dummy.html">step_dummy</a></span>(<span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_outcomes</a></span>(), <span class="kw">one_hot</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="co"># Train the data recipe on the training data</span>
<span class="no">diabetes_trained_rec</span> <span class="kw">&lt;-</span> <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/prep.html">prep</a></span>(<span class="no">diabetes_corels_recipe</span>,
                                      <span class="kw">training</span> <span class="kw">=</span> <span class="no">diabetes_train</span>,
                                      <span class="kw">retain</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="co"># Extract the train data with recipe applied (juice), and the same recipe applied to the test data (bake)</span>
<span class="no">diabetes_train_preprocessed</span> <span class="kw">&lt;-</span> <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/juice.html">juice</a></span>(<span class="no">diabetes_trained_rec</span>)
<span class="no">diabetes_test_preprocessed</span> <span class="kw">&lt;-</span> <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/bake.html">bake</a></span>(<span class="no">diabetes_trained_rec</span>,
                                            <span class="kw">new_data</span> <span class="kw">=</span> <span class="no">diabetes_test</span>)

<span class="co"># View the proccessed trained data</span>
<span class="fu">kable_table</span>(<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">diabetes_train_preprocessed</span>, <span class="fl">5</span>), <span class="kw">title</span> <span class="kw">=</span> <span class="st">"diabetes training data preprocessed"</span>)</pre></body></html></div>
<table class="table table table-striped table-condensed">
<caption>
diabetes training data preprocessed
</caption>
<thead><tr>
<th style="text-align:right;">
pregnant_bin_missing
</th>
<th style="text-align:right;">
pregnant_bin1
</th>
<th style="text-align:right;">
pregnant_bin2
</th>
<th style="text-align:right;">
pregnant_bin3
</th>
<th style="text-align:right;">
pregnant_bin4
</th>
<th style="text-align:right;">
glucose_bin_missing
</th>
<th style="text-align:right;">
glucose_bin1
</th>
<th style="text-align:right;">
glucose_bin2
</th>
<th style="text-align:right;">
glucose_bin3
</th>
<th style="text-align:right;">
glucose_bin4
</th>
<th style="text-align:right;">
pressure_bin_missing
</th>
<th style="text-align:right;">
pressure_bin1
</th>
<th style="text-align:right;">
pressure_bin2
</th>
<th style="text-align:right;">
pressure_bin3
</th>
<th style="text-align:right;">
pressure_bin4
</th>
<th style="text-align:right;">
triceps_bin_missing
</th>
<th style="text-align:right;">
triceps_bin1
</th>
<th style="text-align:right;">
triceps_bin2
</th>
<th style="text-align:right;">
triceps_bin3
</th>
<th style="text-align:right;">
triceps_bin4
</th>
<th style="text-align:right;">
insulin_bin_missing
</th>
<th style="text-align:right;">
insulin_bin1
</th>
<th style="text-align:right;">
insulin_bin2
</th>
<th style="text-align:right;">
insulin_bin3
</th>
<th style="text-align:right;">
insulin_bin4
</th>
<th style="text-align:right;">
mass_bin_missing
</th>
<th style="text-align:right;">
mass_bin1
</th>
<th style="text-align:right;">
mass_bin2
</th>
<th style="text-align:right;">
mass_bin3
</th>
<th style="text-align:right;">
mass_bin4
</th>
<th style="text-align:right;">
pedigree_bin_missing
</th>
<th style="text-align:right;">
pedigree_bin1
</th>
<th style="text-align:right;">
pedigree_bin2
</th>
<th style="text-align:right;">
pedigree_bin3
</th>
<th style="text-align:right;">
pedigree_bin4
</th>
<th style="text-align:right;">
age_bin_missing
</th>
<th style="text-align:right;">
age_bin1
</th>
<th style="text-align:right;">
age_bin2
</th>
<th style="text-align:right;">
age_bin3
</th>
<th style="text-align:right;">
age_bin4
</th>
<th style="text-align:right;">
diabetes_X0
</th>
<th style="text-align:right;">
diabetes_X1
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
</div>
<div id="run-tidycorels" class="section level1">
<h1 class="hasAnchor">
<a href="#run-tidycorels" class="anchor"></a>Run tidycorels</h1>
<p>We can now run <code><a href="../reference/tidy_corels.html">tidycorels::tidy_corels()</a></code> function on the prepared diabetes training data.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">diabetes_train_model</span> <span class="kw">&lt;-</span>
  <span class="kw pkg">tidycorels</span><span class="kw ns">::</span><span class="fu"><a href="../reference/tidy_corels.html">tidy_corels</a></span>(
    <span class="kw">df</span> <span class="kw">=</span> <span class="no">diabetes_train_preprocessed</span>,
    <span class="kw">label_cols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"diabetes_X0"</span>, <span class="st">"diabetes_X1"</span>),
    <span class="kw">value_delim</span> <span class="kw">=</span> <span class="st">"_"</span>,
    <span class="kw">run_bfs</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
    <span class="kw">calculate_size</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
    <span class="kw">run_curiosity</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
    <span class="kw">regularization</span> <span class="kw">=</span> <span class="fl">0.01</span>,
    <span class="kw">curiosity_policy</span> <span class="kw">=</span> <span class="fl">3</span>,
    <span class="kw">map_type</span> <span class="kw">=</span> <span class="fl">1</span>
  )</pre></body></html></div>
<p>Here are the Corels rules for the diabetes data.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">diabetes_train_model</span>$<span class="no">corels_console_output</span>[<span class="fl">4</span>:<span class="fl">10</span>]
<span class="co">#&gt; [1] "OPTIMAL RULE LIST"                             </span>
<span class="co">#&gt; [2] "if ({age:bin1}) then ({diabetes:X0})"          </span>
<span class="co">#&gt; [3] "else if ({glucose:bin4}) then ({diabetes:X1})" </span>
<span class="co">#&gt; [4] "else if ({insulin:bin1}) then ({diabetes:X0})" </span>
<span class="co">#&gt; [5] "else if ({pedigree:bin1}) then ({diabetes:X0})"</span>
<span class="co">#&gt; [6] "else if ({triceps:bin4}) then ({diabetes:X1})" </span>
<span class="co">#&gt; [7] "else ({diabetes:X0})"</span></pre></body></html></div>
<p>And we can view the Corels rules as a <a href="https://christophergandrud.github.io/networkD3/#sankey">D3 network sankey diagram</a> of the rules applied to the training data.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="kw pkg">networkD3</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/networkD3/man/sankeyNetwork.html">sankeyNetwork</a></span>(<span class="co"># edges</span>
                         <span class="kw">Links</span> <span class="kw">=</span> <span class="no">diabetes_train_model</span>$<span class="no">sankey_edges_df</span>,
                         <span class="kw">Value</span> <span class="kw">=</span> <span class="st">"value"</span>,
                         <span class="kw">Source</span> <span class="kw">=</span> <span class="st">"source"</span>,
                         <span class="kw">Target</span> <span class="kw">=</span> <span class="st">"target"</span>,
                         <span class="co"># nodes</span>
                         <span class="kw">Nodes</span> <span class="kw">=</span> <span class="no">diabetes_train_model</span>$<span class="no">sankey_nodes_df</span>,
                         <span class="kw">NodeID</span> <span class="kw">=</span> <span class="st">"label"</span>,
                         <span class="co"># format</span>
                         <span class="kw">fontSize</span> <span class="kw">=</span> <span class="fl">12</span>,
                         <span class="kw">nodeWidth</span> <span class="kw">=</span> <span class="fl">40</span>,
                         <span class="kw">sinksRight</span> <span class="kw">=</span> <span class="fl">TRUE</span>
                         )</pre></body></html></div>
<div id="htmlwidget-9ef2a453e4130af6d84a" style="width:100%;height:432.632880098888px;" class="sankeyNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-9ef2a453e4130af6d84a">{"x":{"links":{"source":[0,0,1,4,4,5,6,6,7,8,8,9,10,11],"target":[4,5,2,6,7,3,8,9,2,10,11,2,2,3],"value":[284,122,170,213,71,122,151,62,71,113,38,62,113,38]},"nodes":{"name":["age_bin1 = 0","age_bin1 = 1","corels_label = 0","corels_label = 1","glucose_bin4 = 0","glucose_bin4 = 1","insulin_bin1 = 0","insulin_bin1 = 1","pedigree_bin1 = 0","pedigree_bin1 = 1","triceps_bin4 = 0","triceps_bin4 = 1"],"group":["age_bin1 = 0","age_bin1 = 1","corels_label = 0","corels_label = 1","glucose_bin4 = 0","glucose_bin4 = 1","insulin_bin1 = 0","insulin_bin1 = 1","pedigree_bin1 = 0","pedigree_bin1 = 1","triceps_bin4 = 0","triceps_bin4 = 1"]},"options":{"NodeID":"label","NodeGroup":"label","LinkGroup":null,"colourScale":"d3.scaleOrdinal(d3.schemeCategory20);","fontSize":12,"fontFamily":null,"nodeWidth":40,"nodePadding":10,"units":"","margin":{"top":null,"right":null,"bottom":null,"left":null},"iterations":32,"sinksRight":true}},"evals":[],"jsHooks":[]}</script><p>And with some manipualation of the nodes and edges data, the rules can be viewed as a <a href="https://datastorm-open.github.io/visNetwork/layout.html">visNetwork</a> visualisation.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">rule_count</span> <span class="kw">&lt;-</span> <span class="kw pkg">base</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">diabetes_train_model</span>$<span class="no">rule_performance_df</span>)
<span class="co"># extract the rule order (or levels)</span>
<span class="no">level</span> <span class="kw">&lt;-</span> <span class="no">diabetes_train_model</span>$<span class="no">rule_performance_df</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">level</span> <span class="kw">=</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span>()) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span>(<span class="kw">level_label</span> <span class="kw">=</span> <span class="no">rule</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">level_label</span>,<span class="no">level</span>)

<span class="co"># rename the edges</span>
<span class="no">edges</span> <span class="kw">&lt;-</span> <span class="no">diabetes_train_model</span>$<span class="no">sankey_edges_df</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span>(<span class="kw">from</span> <span class="kw">=</span> <span class="no">source</span>, <span class="kw">to</span> <span class="kw">=</span> <span class="no">target</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="no">value</span>)

<span class="co"># add the levels</span>
<span class="no">nodes</span> <span class="kw">&lt;-</span> <span class="no">diabetes_train_model</span>$<span class="no">sankey_nodes_df</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="no">ID</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">level_label</span> <span class="kw">=</span> <span class="kw pkg">stringi</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_trim.html">stri_trim_both</a></span>(<span class="kw pkg">stringi</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_sub.html">stri_sub</a></span>(<span class="no">label</span>,<span class="fl">1</span>,-<span class="fl">4</span>))) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="no">level</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">level</span> <span class="kw">=</span> <span class="fu">case_when</span>(<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">level</span>) ~ <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="no">rule_count</span>),<span class="fl">TRUE</span> ~<span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="no">level</span>))) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="no">level_label</span>)

<span class="kw pkg">visNetwork</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/visNetwork/man/visNetwork.html">visNetwork</a></span>(<span class="no">nodes</span>, <span class="no">edges</span>, <span class="kw">width</span> <span class="kw">=</span> <span class="st">"100%"</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">visNetwork</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/visNetwork/man/visNodes.html">visNodes</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">12</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">visNetwork</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/visNetwork/man/visEdges.html">visEdges</a></span>(<span class="kw">arrows</span> <span class="kw">=</span> <span class="st">"to"</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">visNetwork</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/visNetwork/man/visHierarchicalLayout.html">visHierarchicalLayout</a></span>(<span class="kw">direction</span> <span class="kw">=</span> <span class="st">"UD"</span>,
                                    <span class="kw">levelSeparation</span> <span class="kw">=</span> <span class="fl">80</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">visNetwork</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/visNetwork/man/visInteraction.html">visInteraction</a></span>(<span class="kw">navigationButtons</span> <span class="kw">=</span> <span class="fl">TRUE</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">visNetwork</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/visNetwork/man/visOptions.html">visOptions</a></span>(<span class="kw">highlightNearest</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">enabled</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">hover</span> <span class="kw">=</span> <span class="no">T</span>),
                         <span class="kw">nodesIdSelection</span> <span class="kw">=</span> <span class="no">T</span>,
                         <span class="kw">collapse</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<div id="htmlwidget-f0b71748aeb1639bcc82" style="width:100%;height:432.632880098888px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-f0b71748aeb1639bcc82">{"x":{"nodes":{"label":["age_bin1 = 0","age_bin1 = 1","corels_label = 0","corels_label = 1","glucose_bin4 = 0","glucose_bin4 = 1","insulin_bin1 = 0","insulin_bin1 = 1","pedigree_bin1 = 0","pedigree_bin1 = 1","triceps_bin4 = 0","triceps_bin4 = 1"],"id":[0,1,2,3,4,5,6,7,8,9,10,11],"title":["age_bin1","age_bin1","corels_label","corels_label","glucose_bin4","glucose_bin4","insulin_bin1","insulin_bin1","pedigree_bin1","pedigree_bin1","triceps_bin4","triceps_bin4"],"level":[1,1,6,6,2,2,3,3,4,4,5,5]},"edges":{"from":[0,0,1,4,4,5,6,6,7,8,8,9,10,11],"to":[4,5,2,6,7,3,8,9,2,10,11,2,2,3],"value":[284,122,170,213,71,122,151,62,71,113,38,62,113,38],"title":[284,122,170,213,71,122,151,62,71,113,38,62,113,38]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","size":12},"manipulation":{"enabled":false},"edges":{"arrows":"to"},"layout":{"hierarchical":{"enabled":true,"levelSeparation":80,"direction":"UD"}},"interaction":{"navigationButtons":true,"hover":true}},"groups":null,"width":"100%","height":null,"idselection":{"enabled":true,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":null,"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);","highlight":{"enabled":true,"hoverNearest":true,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"}},"evals":[],"jsHooks":[]}</script><p>A dataframe of just the true label, the columns used in the Corels rules, and the Corels predictions is also available. The columns have been ordered for you to work well in an <a href="https://github.com/erblast/easyalluvial/blob/master/README.md">alluvial</a> plot.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">p</span> <span class="kw">&lt;-</span> <span class="no">diabetes_train_model</span>$<span class="no">alluvial_df</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">easyalluvial</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/easyalluvial/man/alluvial_wide.html">alluvial_wide</a></span>(<span class="kw">stratum_width</span> <span class="kw">=</span> <span class="fl">0.2</span>,
                              <span class="kw">NA_label</span> <span class="kw">=</span> <span class="st">"not used"</span>,
                           <span class="kw">col_vector_flow</span> <span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"lightgreen"</span>,<span class="st">"#CC6666"</span>)) +
  <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span>() +
  <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(
    <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Corels if-then-else logic"</span>,
    <span class="kw">subtitle</span> <span class="kw">=</span> <span class="st">" From truth (far left column) to Corels classification (far right column)"</span>
  )
<span class="no">p</span></pre></body></html></div>
<p><img src="diabetes_example_files/figure-html/unnamed-chunk-8-1.png" width="80%"></p>
</div>
<div id="performance-on-test-data" class="section level1">
<h1 class="hasAnchor">
<a href="#performance-on-test-data" class="anchor"></a>Performance on test data</h1>
<p>Next we use the function <code>tidycorels::corels_predict()</code> to apply the Corels rules created on the training data to the test data.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">diabetes_test_predict</span> <span class="kw">&lt;-</span>
  <span class="kw pkg">tidycorels</span><span class="kw ns">::</span><span class="fu"><a href="../reference/predict_corels.html">predict_corels</a></span>(
  <span class="kw">model</span> <span class="kw">=</span> <span class="no">diabetes_train_model</span>,
    <span class="kw">new_df</span> <span class="kw">=</span> <span class="no">diabetes_test_preprocessed</span>
  )</pre></body></html></div>
<p>We can now use the test data that has been labelled using the Corels rules to compare to the true labe with a confusion matrix and performance statistics.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">conf_matrix</span> <span class="kw">&lt;-</span>
  <span class="no">diabetes_test_predict</span>$<span class="no">new_df_labelled</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">yardstick</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/yardstick/man/conf_mat.html">conf_mat</a></span>(
    <span class="kw">truth</span> <span class="kw">=</span> <span class="st">"diabetes_X1"</span>,
    <span class="kw">estimate</span> <span class="kw">=</span> <span class="st">"corels_label"</span>
  )

<span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span>(<span class="no">conf_matrix</span>, <span class="st">"heatmap"</span>)</pre></body></html></div>
<p><img src="diabetes_example_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<div class="sourceCode" id="cb11"><html><body><pre class="r">
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">conf_matrix</span>,
        <span class="kw">event_level</span> <span class="kw">=</span> <span class="st">"second"</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">:::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">.estimate</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">.estimate</span>, <span class="kw">digits</span> <span class="kw">=</span> <span class="fl">3</span>)) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">.metric</span>, <span class="no">.estimate</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">.metric</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"accuracy"</span>,<span class="st">"bal_accuracy"</span>,<span class="st">"precision"</span>, <span class="st">"recall"</span>, <span class="st">"f_meas"</span>)) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">.estimate</span> <span class="kw">=</span> <span class="kw pkg">formattable</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/formattable/man/color_tile.html">color_tile</a></span>(<span class="st">"white"</span>, <span class="st">"orange"</span>)(<span class="no">.estimate</span>)) <span class="kw">%&gt;%</span>
  <span class="kw pkg">kableExtra</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/reexports.html">kable</a></span>(<span class="kw">escape</span> <span class="kw">=</span> <span class="no">F</span>,
                   <span class="kw">caption</span> <span class="kw">=</span> <span class="st">"Corels Test data Performance"</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">kableExtra</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span>(<span class="st">"hover"</span>, <span class="kw">full_width</span> <span class="kw">=</span> <span class="no">F</span>)</pre></body></html></div>
<table class="table table table-hover">
<caption>
Corels Test data Performance
</caption>
<thead><tr>
<th style="text-align:left;">
.metric
</th>
<th style="text-align:left;">
.estimate
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
accuracy
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffa500">0.745</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
bal_accuracy
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffb836">0.714</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
precision
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffd589">0.667</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
recall
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffffff">0.600</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
f_meas
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffebc6">0.632</span>
</td>
</tr>
</tbody>
</table>
<p>The accuracy achieved by Corels on the unseen test data is . This is the same accuracy the random forest reached in Rebbeca’s example. In contrast, Corels rules are easy to read and visualise with an alluvial plot. For example, below if we follow the thickest red path through the Corels rules where diabetes was correctly labelled. We can see they are:</p>
<ol style="list-style-type: decimal">
<li>in older age groups (age_bin1 = 0)</li>
<li>have the highest blood glucose concentraion (glucose_bin4 = 1),</li>
</ol>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">p</span> <span class="kw">&lt;-</span> <span class="no">diabetes_test_predict</span>$<span class="no">alluvial_df</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">easyalluvial</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/easyalluvial/man/alluvial_wide.html">alluvial_wide</a></span>(<span class="kw">stratum_width</span> <span class="kw">=</span> <span class="fl">0.2</span>,
                              <span class="kw">NA_label</span> <span class="kw">=</span> <span class="st">"not used"</span>,
                           <span class="kw">col_vector_flow</span> <span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"lightgreen"</span>,<span class="st">"#CC6666"</span>)) +
  <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span>() +
  <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(
    <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Corels if-then-else logic"</span>,
    <span class="kw">subtitle</span> <span class="kw">=</span> <span class="st">" From truth (far left column) to Corels classification (far right column)"</span>
  )
<span class="no">p</span></pre></body></html></div>
<p><img src="diabetes_example_files/figure-html/unnamed-chunk-11-1.png" width="80%"></p>
<p>We can also create an <a href="https://erblast.github.io/easyalluvial/articles/parcats.html">interactive</a> version of the alluvial plot.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="kw pkg">parcats</span><span class="kw ns">::</span><span class="fu"><a href="https://erblast.github.io/parcats//reference/parcats.html">parcats</a></span>(<span class="kw">p</span> <span class="kw">=</span> <span class="no">p</span>,
                 <span class="kw">data_input</span> <span class="kw">=</span> <span class="no">diabetes_test_predict</span>$<span class="no">alluvial_df</span>,
                 <span class="kw">marginal_histograms</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
                 <span class="kw">hoveron</span> <span class="kw">=</span> <span class="st">'dimension'</span>,
                 <span class="kw">hoverinfo</span> <span class="kw">=</span> <span class="st">'count'</span>,
                 <span class="kw">labelfont</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">11</span>)
)</pre></body></html></div>
<div id="htmlwidget-29ad7fa36d63229e3710" style="width:100%;height:432.632880098888px;" class="parcats html-widget"></div>
<script type="application/json" data-for="htmlwidget-29ad7fa36d63229e3710">{"x":{"traces":{"parcats":{"type":"parcats","dimensions":[{"label":"diabetes_X1","values":["0","0","0","0","0","0","1","1","1","1","1","1"],"categoryorder":"array","categoryarray":["1","0"]},{"label":"age_bin1","values":["0","0","0","0","0","1","0","0","0","0","0","1"],"categoryorder":"array","categoryarray":["1","0"]},{"label":"glucose_bin4","values":["0","0","0","0","1","not used","0","0","0","0","1","not used"],"categoryorder":"array","categoryarray":["not used","1","0"]},{"label":"insulin_bin1","values":["0","0","0","1","not used","not used","0","0","0","1","not used","not used"],"categoryorder":"array","categoryarray":["not used","1","0"]},{"label":"pedigree_bin1","values":["0","0","1","not used","not used","not used","0","0","1","not used","not used","not used"],"categoryorder":"array","categoryarray":["not used","1","0"]},{"label":"triceps_bin4","values":["0","1","not used","not used","not used","not used","0","1","not used","not used","not used","not used"],"categoryorder":"array","categoryarray":["not used","1","0"]},{"label":"corels_label","values":["0","1","0","0","1","0","0","1","0","0","1","0"],"categoryorder":"array","categoryarray":["1","0"]}],"counts":[16,11,9,34,10,42,10,10,6,5,32,7],"line":{"shape":"hspline","color":["lightgreen","lightgreen","lightgreen","lightgreen","lightgreen","lightgreen","#CC6666","#CC6666","#CC6666","#CC6666","#CC6666","#CC6666"]},"hoveron":"dimension","hoverinfo":"count","labelfont":{"size":11},"arrangement":"perpendicular","bundlecolors":true,"sortpaths":"forward","tickfont":null,"domain":{"y":[0,1]}}},"layout":[],"shapes":[],"shapes_original":[],"map_curve":[],"map_trace_2_shape":[],"map_type":[],"map_color":[],"parcats_cols":["lightgreen","lightgreen","lightgreen","lightgreen","lightgreen","lightgreen","#CC6666","#CC6666","#CC6666","#CC6666","#CC6666","#CC6666"],"imp":false},"evals":[],"jsHooks":[]}</script><p>A data frame of the performance of each rule is also provided. This shows us that one of the weaker rules is <code>triceps_bin4</code>.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">diabetes_test_predict</span>$<span class="no">rule_performance_df</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">rule_perc_correct</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">rule_perc_correct</span>,<span class="fl">1</span>)) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">rule_perc_correct</span> <span class="kw">=</span> <span class="kw pkg">formattable</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/formattable/man/color_tile.html">color_tile</a></span>(<span class="st">"white"</span>, <span class="st">"orange"</span>)(<span class="no">rule_perc_correct</span>)) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">rule_fire_count</span> <span class="kw">=</span> <span class="kw pkg">formattable</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/formattable/man/color_tile.html">color_tile</a></span>(<span class="st">"white"</span>, <span class="st">"lightblue"</span>)(<span class="no">rule_fire_count</span>)) <span class="kw">%&gt;%</span>
  <span class="kw pkg">kableExtra</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/reexports.html">kable</a></span>(<span class="kw">escape</span> <span class="kw">=</span> <span class="no">F</span>,
                   <span class="kw">caption</span> <span class="kw">=</span> <span class="st">"Corels Performance for each rule in order"</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">kableExtra</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span>(<span class="st">"hover"</span>, <span class="kw">full_width</span> <span class="kw">=</span> <span class="no">F</span>)</pre></body></html></div>
<table class="table table table-hover">
<caption>
Corels Performance for each rule in order
</caption>
<thead><tr>
<th style="text-align:left;">
rule
</th>
<th style="text-align:left;">
rule_fire_count
</th>
<th style="text-align:right;">
rule_correct
</th>
<th style="text-align:left;">
rule_perc_correct
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
age_bin1
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #add8e6">49</span>
</td>
<td style="text-align:right;">
42
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffa809">85.7</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
glucose_bin4
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #bde0eb">42</span>
</td>
<td style="text-align:right;">
32
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffbe46">76.2</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
insulin_bin1
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #c5e3ed">39</span>
</td>
<td style="text-align:right;">
34
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffa500">87.2</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
pedigree_bin1
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffffff">15</span>
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffe2af">60.0</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
triceps_bin4
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #f0f8fa">21</span>
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffffff">47.6</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
else
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #e4f2f6">26</span>
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffdfa5">61.5</span>
</td>
</tr>
</tbody>
</table>
<p>If we examine rule success on the training data the weaker <code>triceps_bin4</code> does perform well in the training data. However, we usually cannot use test data to improve a classifier without risking overfitting (though one option would be to use all of the data to build Corels rules with cross validation).</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">diabetes_train_model</span>$<span class="no">rule_performance_df</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">rule_perc_correct</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">rule_perc_correct</span>,<span class="fl">1</span>)) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">rule_perc_correct</span> <span class="kw">=</span> <span class="kw pkg">formattable</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/formattable/man/color_tile.html">color_tile</a></span>(<span class="st">"white"</span>, <span class="st">"orange"</span>)(<span class="no">rule_perc_correct</span>)) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">rule_fire_count</span> <span class="kw">=</span> <span class="kw pkg">formattable</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/formattable/man/color_tile.html">color_tile</a></span>(<span class="st">"white"</span>, <span class="st">"lightblue"</span>)(<span class="no">rule_fire_count</span>)) <span class="kw">%&gt;%</span>
  <span class="kw pkg">kableExtra</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/reexports.html">kable</a></span>(<span class="kw">escape</span> <span class="kw">=</span> <span class="no">F</span>,
                   <span class="kw">caption</span> <span class="kw">=</span> <span class="st">"Corels Performance for each rule in order"</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">kableExtra</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span>(<span class="st">"hover"</span>, <span class="kw">full_width</span> <span class="kw">=</span> <span class="no">F</span>)</pre></body></html></div>
<table class="table table table-hover">
<caption>
Corels Performance for each rule in order
</caption>
<thead><tr>
<th style="text-align:left;">
rule
</th>
<th style="text-align:left;">
rule_fire_count
</th>
<th style="text-align:right;">
rule_correct
</th>
<th style="text-align:left;">
rule_perc_correct
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
age_bin1
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #add8e6">170</span>
</td>
<td style="text-align:right;">
146
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffb632">85.9</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
glucose_bin4
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #cae6ef">122</span>
</td>
<td style="text-align:right;">
88
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #fff1d9">72.1</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
insulin_bin1
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #eaf5f8">71</span>
</td>
<td style="text-align:right;">
64
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffa500">90.1</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
pedigree_bin1
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #f0f7fa">62</span>
</td>
<td style="text-align:right;">
47
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffe1ac">75.8</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
triceps_bin4
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffffff">38</span>
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffdfa6">76.3</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
else
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #d0e8f0">113</span>
</td>
<td style="text-align:right;">
78
</td>
<td style="text-align:left;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffffff">69.0</span>
</td>
</tr>
</tbody>
</table>
<p>Further, below we visualise the distribution of the raw values of each categorised bin used in each rule.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">diabetes_recipe_non_dummy</span> <span class="kw">&lt;-</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html">recipe</a></span>(<span class="no">diabetes</span> ~ <span class="no">pregnant</span> + <span class="no">glucose</span> + <span class="no">pressure</span> + <span class="no">triceps</span> + <span class="no">insulin</span> + <span class="no">mass</span> + <span class="no">pedigree</span> + <span class="no">age</span>,
                  <span class="kw">data</span> <span class="kw">=</span> <span class="no">diabetes_clean</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/step_normalize.html">step_normalize</a></span>(<span class="fu">all_numeric</span>()) <span class="kw">%&gt;%</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/step_knnimpute.html">step_knnimpute</a></span>(<span class="fu">all_predictors</span>()) <span class="kw">%&gt;%</span>
  <span class="co"># discretise numeric variables into bins</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/step_discretize.html">step_discretize</a></span>(-<span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_outcomes</a></span>(), <span class="kw">min_unique</span> <span class="kw">=</span> <span class="fl">1</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/step_mutate_at.html">step_mutate_at</a></span>(<span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_predictors</a></span>(), <span class="kw">fn</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(~ <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">.</span>))) <span class="kw">%&gt;%</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/step_mutate_at.html">step_mutate_at</a></span>(<span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_outcomes</a></span>(), <span class="kw">fn</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(~ <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">.</span>)))

<span class="no">diabetes_train_preprocessed</span> <span class="kw">&lt;-</span>
  <span class="no">diabetes_recipe_non_dummy</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/prep.html">prep</a></span>(<span class="no">diabetes_train</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/juice.html">juice</a></span>()

<span class="no">combined</span> <span class="kw">&lt;-</span> <span class="no">diabetes_train_preprocessed</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename_with</a></span>(<span class="no">toupper</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(<span class="no">diabetes_train</span>)

<span class="no">plot_fun</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">X</span>, <span class="no">Y</span>, <span class="no">bin</span>) {
  <span class="no">X</span> <span class="kw">&lt;-</span> <span class="kw pkg">rlang</span><span class="kw ns">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/nse-defuse.html">ensym</a></span>(<span class="no">X</span>)
  <span class="no">Y</span> <span class="kw">&lt;-</span> <span class="kw pkg">rlang</span><span class="kw ns">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/nse-defuse.html">ensym</a></span>(<span class="no">Y</span>)
  <span class="no">bin</span> <span class="kw">&lt;-</span> <span class="kw pkg">rlang</span><span class="kw ns">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/nse-defuse.html">ensym</a></span>(<span class="no">bin</span>)

  <span class="no">combined</span> <span class="kw">%&gt;%</span>
    <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu">aes</span>(
      <span class="kw">x</span> <span class="kw">=</span> !!<span class="no">X</span>,
      <span class="kw">y</span> <span class="kw">=</span> !!<span class="no">Y</span>
    )) +
    <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html">geom_violin</a></span>(<span class="kw">scale</span> <span class="kw">=</span> <span class="st">"count"</span>) +
    <span class="kw pkg">gghighlight</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/gghighlight/man/gghighlight.html">gghighlight</a></span>(!!<span class="no">X</span> <span class="kw">==</span> <span class="no">bin</span>) +
    <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span>()
}

<span class="no">p1</span> <span class="kw">&lt;-</span> <span class="fu">plot_fun</span>(<span class="kw">X</span> <span class="kw">=</span> <span class="no">AGE</span>, <span class="kw">Y</span> <span class="kw">=</span> <span class="no">age</span>, <span class="kw">bin</span> <span class="kw">=</span> <span class="no">bin1</span>)
<span class="no">p2</span> <span class="kw">&lt;-</span> <span class="fu">plot_fun</span>(<span class="kw">X</span> <span class="kw">=</span> <span class="no">GLUCOSE</span>, <span class="kw">Y</span> <span class="kw">=</span> <span class="no">glucose</span>, <span class="kw">bin</span> <span class="kw">=</span> <span class="no">bin4</span>)
<span class="no">p3</span> <span class="kw">&lt;-</span> <span class="fu">plot_fun</span>(<span class="kw">X</span> <span class="kw">=</span> <span class="no">INSULIN</span>, <span class="kw">Y</span> <span class="kw">=</span> <span class="no">insulin</span>, <span class="kw">bin</span> <span class="kw">=</span> <span class="no">bin1</span>)
<span class="no">p4</span> <span class="kw">&lt;-</span> <span class="fu">plot_fun</span>(<span class="kw">X</span> <span class="kw">=</span> <span class="no">PEDIGREE</span>, <span class="kw">Y</span> <span class="kw">=</span> <span class="no">pedigree</span>, <span class="kw">bin</span> <span class="kw">=</span> <span class="no">bin1</span>)
<span class="no">p5</span> <span class="kw">&lt;-</span> <span class="fu">plot_fun</span>(<span class="kw">X</span> <span class="kw">=</span> <span class="no">TRICEPS</span>, <span class="kw">Y</span> <span class="kw">=</span> <span class="no">triceps</span>, <span class="kw">bin</span> <span class="kw">=</span> <span class="no">bin4</span>)
<span class="kw pkg">cowplot</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/cowplot/man/plot_grid.html">plot_grid</a></span>(<span class="no">p1</span>, <span class="no">p2</span>, <span class="no">p3</span>, <span class="no">p4</span>, <span class="no">p5</span>)</pre></body></html></div>
<p><img src="diabetes_example_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>The plots from left to right highlight which bin is used in each Corels rule in the sequential order of the rules. The plot is created by combining the <a href="https://recipes.tidymodels.org/reference/step_discretize.html">discretised</a> and one-hot encoded data with the raw column values.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Bill Cockerill.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
