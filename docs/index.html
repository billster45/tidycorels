<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tools to help use corels with tidymodels • tidycorels</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Tools to help use corels with tidymodels">
<meta property="og:description" content="The main reason for tidycorels is to convert your dataframe into two text files 
             into the format the R package corels expects, and apply them to your dataframe or a 
             new dataframe (e.g. test data).">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">tidycorels</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/diabetes_example.html">Corels vs Random Forest</a>
    </li>
    <li>
      <a href="articles/german_credit_data_example.html">Corels vs XGBoost</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/billster45/tidycorels">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="tidycorels" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#tidycorels" class="anchor"></a>tidycorels</h1></div>
<ul>
<li><a href="#what-are-corels-and-tidycorels">What are corels and tidycorels?</a></li>
<li><a href="#installation">Installation</a></li>
<li>
<a href="#simple-example">Simple example</a>
<ul>
<li><a href="#prepare-dataframe-for-corels">Prepare dataframe for Corels</a></li>
<li><a href="#alluvial-plot">Alluvial plot</a></li>
<li><a href="#performance-on-training-data">Performance on training data</a></li>
<li><a href="#performance-of-each-rule">Performance of each rule</a></li>
<li><a href="#performance-on-new-data">Performance on new data</a></li>
</ul>
</li>
</ul>
<div id="what-are-corels-and-tidycorels" class="section level2">
<h2 class="hasAnchor">
<a href="#what-are-corels-and-tidycorels" class="anchor"></a>What are corels and tidycorels?</h2>
<blockquote>
<p>Corels are <a href="https://corels.eecs.harvard.edu/">‘Certifiably Optimal RulE ListS’</a>. They are short and simple human <a href="https://arxiv.org/pdf/1704.01701.pdf">interpretable rule lists</a> created on categorical data.</p>
</blockquote>
<p>The Corels authors <a href="https://corels.eecs.harvard.edu/corels/whatarerulelists.html">say</a> that.. <em>“The advantage of rule lists as predictive models is that they are human interpretable, as opposed to black box models such as neural nets. Proponents of such non-interpretable models often claim that they are necessary to achieve greater accuracy, but we have shown that it is possible for rule lists to have comparable or even greater accuracy.”</em></p>
<p><code><a href="reference/tidy_corels.html">tidycorels::tidy_corels()</a></code> converts your dataframe into two text files in the format the R package <a href="https://cran.r-project.org/package=corels">corels</a> expects. It returns the Corels rules as well as applying them to your dataframe using <a href="https://rdatatable.gitlab.io/data.table/reference/fifelse.html"><code><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">data.table::fifelse()</a></code></a> code. Your dataframe is also returned with fewer columns ready to be used in an insightful <a href="https://github.com/erblast/easyalluvial/blob/master/README.md">alluvial</a> plot. It can reveal intuitively both how the Corels rules are applied to your dataframe, and where the classification is correct or incorrect. This reduced dataframe includes: the true label, the columns used in the Corels rules in rule order, then the label column the rules create.</p>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<div class="sourceCode" id="cb1"><pre class="r"><span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span>(<span class="st">"billster45/tidycorels"</span>)</pre></div>
</div>
<div id="simple-example" class="section level2">
<h2 class="hasAnchor">
<a href="#simple-example" class="anchor"></a>Simple example</h2>
<p>Let’s use tidycorels to classify cars in <code><a href="https://rdrr.io/r/datasets/mtcars.html">datasets::mtcars</a></code> as either automatic or manual.</p>
<div id="prepare-dataframe-for-corels" class="section level3">
<h3 class="hasAnchor">
<a href="#prepare-dataframe-for-corels" class="anchor"></a>Prepare dataframe for Corels</h3>
<p>Using <a href="https://recipes.tidymodels.org/"><code>recipes</code></a> functions in <a href="https://www.tidymodels.org/"><code>tidymodels</code></a>, columns with continuous values are binned or <a href="https://recipes.tidymodels.org/reference/step_discretize.html">discretised</a> into categorical data. Each bin in each column is given its own 0/1 binary column using <a href="https://recipes.tidymodels.org/reference/step_dummy.html">`recipes::step_dummy()</a>. This is sometimes called one-hot encoding.</p>
<p>Corels also requires the label column is split into two columns representing each class. In this example, <code>am</code> is the label for Corels to classify where 0 = automatic and 1 = manual gears.</p>
<div class="sourceCode" id="cb2"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidymodels</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">corels</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidycorels</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">easyalluvial</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">parcats</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">networkD3</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">visNetwork</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">formattable</span>)

<span class="no">mtcars_recipe</span> <span class="kw">&lt;-</span><span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html">recipe</a></span>(<span class="no">am</span> ~ <span class="no">.</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="kw pkg">datasets</span><span class="kw ns">::</span><span class="no"><a href="https://rdrr.io/r/datasets/mtcars.html">mtcars</a></span>) <span class="kw">%&gt;%</span>
  <span class="co"># 1 discretise continous variables into bins</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/step_discretize.html">step_discretize</a></span>(<span class="no">mpg</span>, <span class="no">disp</span>, <span class="no">hp</span>, <span class="no">drat</span>, <span class="no">wt</span>, <span class="no">qsec</span>, <span class="kw">min_unique</span> <span class="kw">=</span> <span class="fl">1</span>) <span class="kw">%&gt;%</span>
  <span class="co"># 2 convert each value of each predictor into its own 0/1 binary column</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/step_mutate_at.html">step_mutate_at</a></span>(<span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_predictors</a></span>(), <span class="kw">fn</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(~ <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">.</span>))) <span class="kw">%&gt;%</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/step_dummy.html">step_dummy</a></span>(<span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_predictors</a></span>(), <span class="kw">one_hot</span> <span class="kw">=</span> <span class="fl">TRUE</span>) <span class="kw">%&gt;%</span>
  <span class="co"># 3 convert each value of the outcome column into its own 0/1 binary column</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/step_integer.html">step_integer</a></span>(<span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_outcomes</a></span>(), <span class="kw">zero_based</span> <span class="kw">=</span> <span class="fl">TRUE</span>) <span class="kw">%&gt;%</span> <span class="co"># ensure outcome is 0/1 rather than words</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/step_mutate_at.html">step_mutate_at</a></span>(<span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_outcomes</a></span>(), <span class="kw">fn</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(~ <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="no">.</span>))) <span class="kw">%&gt;%</span>
  <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/step_dummy.html">step_dummy</a></span>(<span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_outcomes</a></span>(), <span class="kw">one_hot</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="co"># Train the recipe</span>
<span class="no">mtcars_recipe_prep</span> <span class="kw">&lt;-</span> <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/prep.html">prep</a></span>(<span class="no">mtcars_recipe</span>,
                                    <span class="kw">training</span> <span class="kw">=</span> <span class="kw pkg">datasets</span><span class="kw ns">::</span><span class="no"><a href="https://rdrr.io/r/datasets/mtcars.html">mtcars</a></span>,
                                    <span class="kw">retain</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="co"># Extract the pre-processed data</span>
<span class="no">mtcars_preprocessed</span> <span class="kw">&lt;-</span> <span class="kw pkg">recipes</span><span class="kw ns">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/juice.html">juice</a></span>(<span class="no">mtcars_recipe_prep</span>)</pre></div>
<p>The prepared dataframe can now be used in the <code><a href="reference/tidy_corels.html">tidycorels::tidy_corels()</a></code> function. We need to specify the names of the two columns that represent the label, and the delimiter that seperates the column name from the value each dummy column represents. The default seperator used by <a href="https://recipes.tidymodels.org/reference/step_dummy.html">`recipes::step_dummy()</a> is an underscore.</p>
<p>All other arguments of <code><a href="https://rdrr.io/pkg/corels/man/corels.html">corels::corels()</a></code> are available to set, other than the following that are fixed by <code><a href="reference/tidy_corels.html">tidycorels::tidy_corels()</a></code>: <code>rules_file</code> (generated from <code>df</code>), <code>labels_file</code> (generated from <code>df</code>), <code>log_dir</code> (set as <code><a href="https://rdrr.io/r/base/getwd.html">getwd()</a></code>), <code>verbosity_policy</code> (set as “minor”).</p>
<div class="sourceCode" id="cb3"><pre class="r"><span class="no">corels_mtcars</span> <span class="kw">&lt;-</span>
  <span class="kw pkg">tidycorels</span><span class="kw ns">::</span><span class="fu"><a href="reference/tidy_corels.html">tidy_corels</a></span>(
    <span class="kw">df</span> <span class="kw">=</span> <span class="no">mtcars_preprocessed</span>,
    <span class="kw">label_cols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"am_X0"</span>, <span class="st">"am_X1"</span>),
    <span class="kw">value_delim</span> <span class="kw">=</span> <span class="st">"_"</span>,
    <span class="kw">run_bfs</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
    <span class="kw">calculate_size</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
    <span class="kw">run_curiosity</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
    <span class="kw">regularization</span> <span class="kw">=</span> <span class="fl">0.01</span>,
    <span class="kw">curiosity_policy</span> <span class="kw">=</span> <span class="fl">3</span>,
    <span class="kw">map_type</span> <span class="kw">=</span> <span class="fl">1</span>
  )</pre></div>
<p>A list of useful objects is returned. First let’s view the rules captured from the console output of <code><a href="https://rdrr.io/pkg/corels/man/corels.html">corels::corels()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="r"><span class="no">corels_mtcars</span>$<span class="no">corels_console_output</span>[<span class="fl">4</span>:<span class="fl">8</span>]</pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="co">## [1] "OPTIMAL RULE LIST"                  "if ({gear:X3}) then ({am:X0})"     </span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="co">## [3] "else if ({wt:bin1}) then ({am:X1})" "else if ({vs:X0}) then ({am:X1})"  </span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="co">## [5] "else ({am:X0})"</span></a></code></pre></div>
<p>And see those rules converted to <code><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html">data.table::fifelse()</a></code> code.</p>
<div class="sourceCode" id="cb6"><pre class="r"><span class="no">corels_mtcars</span>$<span class="no">corels_rules_DT</span></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="co">## [1] "DT[,corels_label := fifelse( `gear_X3` == 1, 0,fifelse( `wt_bin1` == 1, 1,fifelse( `vs_X0` == 1, 1,0)))]"</span></a></code></pre></div>
<p>And we can view the Corels rules as a <a href="https://christophergandrud.github.io/networkD3/#sankey">D3 network sankey diagram</a> of the rules applied to the training data.</p>
<div class="sourceCode" id="cb8"><pre class="r"><span class="kw pkg">networkD3</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/networkD3/man/sankeyNetwork.html">sankeyNetwork</a></span>(<span class="co"># edges</span>
                         <span class="kw">Links</span> <span class="kw">=</span> <span class="no">corels_mtcars</span>$<span class="no">sankey_edges_df</span>,
                         <span class="kw">Value</span> <span class="kw">=</span> <span class="st">"value"</span>,
                         <span class="kw">Source</span> <span class="kw">=</span> <span class="st">"source"</span>,
                         <span class="kw">Target</span> <span class="kw">=</span> <span class="st">"target"</span>,
                         <span class="co"># nodes</span>
                         <span class="kw">Nodes</span> <span class="kw">=</span> <span class="no">corels_mtcars</span>$<span class="no">sankey_nodes_df</span>,
                         <span class="kw">NodeID</span> <span class="kw">=</span> <span class="st">"label"</span>,
                         <span class="co"># format</span>
                         <span class="kw">fontSize</span> <span class="kw">=</span> <span class="fl">16</span>,
                         <span class="kw">nodeWidth</span> <span class="kw">=</span> <span class="fl">40</span>,
                         <span class="kw">sinksRight</span> <span class="kw">=</span> <span class="fl">TRUE</span>
                         )</pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-6-1.png"><!-- --></p>
<p>And with some manipualation of the nodes and edges data, the rules can be viewed as a <a href="https://datastorm-open.github.io/visNetwork/layout.html">visNetwork</a> visualisation.</p>
<div class="sourceCode" id="cb9"><pre class="r"><span class="no">rule_count</span> <span class="kw">&lt;-</span> <span class="kw pkg">base</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">corels_mtcars</span>$<span class="no">rule_performance_df</span>)
<span class="co"># extract the rule order (or levels)</span>
<span class="no">level</span> <span class="kw">&lt;-</span> <span class="no">corels_mtcars</span>$<span class="no">rule_performance_df</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">level</span> <span class="kw">=</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span>()) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span>(<span class="kw">level_label</span> <span class="kw">=</span> <span class="no">rule</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">level_label</span>,<span class="no">level</span>)

<span class="co"># rename the edges</span>
<span class="no">edges</span> <span class="kw">&lt;-</span> <span class="no">corels_mtcars</span>$<span class="no">sankey_edges_df</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span>(<span class="kw">from</span> <span class="kw">=</span> <span class="no">source</span>, <span class="kw">to</span> <span class="kw">=</span> <span class="no">target</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="no">value</span>)

<span class="co"># add the levels</span>
<span class="no">nodes</span> <span class="kw">&lt;-</span> <span class="no">corels_mtcars</span>$<span class="no">sankey_nodes_df</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="no">ID</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">level_label</span> <span class="kw">=</span> <span class="kw pkg">stringi</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_trim.html">stri_trim_both</a></span>(<span class="kw pkg">stringi</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_sub.html">stri_sub</a></span>(<span class="no">label</span>,<span class="fl">1</span>,-<span class="fl">4</span>))) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="no">level</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">level</span> <span class="kw">=</span> <span class="fu">case_when</span>(<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">level</span>) ~ <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="no">rule_count</span>),<span class="fl">TRUE</span> ~<span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="no">level</span>))) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="no">level_label</span>)

<span class="kw pkg">visNetwork</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/visNetwork/man/visNetwork.html">visNetwork</a></span>(<span class="no">nodes</span>, <span class="no">edges</span>, <span class="kw">width</span> <span class="kw">=</span> <span class="st">"100%"</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">visNetwork</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/visNetwork/man/visNodes.html">visNodes</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">12</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">visNetwork</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/visNetwork/man/visEdges.html">visEdges</a></span>(<span class="kw">arrows</span> <span class="kw">=</span> <span class="st">"to"</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">visNetwork</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/visNetwork/man/visHierarchicalLayout.html">visHierarchicalLayout</a></span>(<span class="kw">direction</span> <span class="kw">=</span> <span class="st">"UD"</span>,
                                    <span class="kw">levelSeparation</span> <span class="kw">=</span> <span class="fl">80</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">visNetwork</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/visNetwork/man/visInteraction.html">visInteraction</a></span>(<span class="kw">navigationButtons</span> <span class="kw">=</span> <span class="fl">TRUE</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">visNetwork</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/visNetwork/man/visOptions.html">visOptions</a></span>(<span class="kw">highlightNearest</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">enabled</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">hover</span> <span class="kw">=</span> <span class="no">T</span>),
                         <span class="kw">nodesIdSelection</span> <span class="kw">=</span> <span class="no">T</span>,
                         <span class="kw">collapse</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-7-1.png"><!-- --></p>
</div>
<div id="alluvial-plot" class="section level3">
<h3 class="hasAnchor">
<a href="#alluvial-plot" class="anchor"></a>Alluvial plot</h3>
<p>A dataframe of just the true label, the columns used in the Corels rules, and the Corels label from those rules is also available. The columns have been ordered in the order of the Corels rules so that they work well in an <a href="https://github.com/erblast/easyalluvial/blob/master/README.md">alluvial</a> plot.</p>
<div class="sourceCode" id="cb10"><pre class="r"><span class="no">p</span> <span class="kw">&lt;-</span> <span class="no">corels_mtcars</span>$<span class="no">alluvial_df</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">easyalluvial</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/easyalluvial/man/alluvial_wide.html">alluvial_wide</a></span>(<span class="kw">stratum_width</span> <span class="kw">=</span> <span class="fl">0.2</span>,
                              <span class="kw">NA_label</span> <span class="kw">=</span> <span class="st">"not used"</span>) +
  <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span>() +
  <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(
    <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Corels if-then-else logic"</span>,
    <span class="kw">subtitle</span> <span class="kw">=</span> <span class="st">" From truth (far left column) to Corels classification (far right column)"</span>
  )
<span class="no">p</span></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-8-1.png"><!-- --></p>
<p>The leftmost column is the true label for each car, either automatic (0) or manual (1). The rightmost column is the Corels classification label after applying the rules from left to right.</p>
<p>The alluvial plot clearly shows which rules are important in the classifcation and exactly how the classifiation is arrived at. For example, if we follow one green path of manual cars (am_X1 = 1), they have more than 3 gears (gear_X3 = 0), low weight (wt_bin_1 ==1). The shape of the engine (vs_x0) column is not used.</p>
<p>We can also create an <a href="https://erblast.github.io/easyalluvial/articles/parcats.html">interactive</a> version of the alluvial plot.</p>
<div class="sourceCode" id="cb11"><pre class="r"><span class="kw pkg">parcats</span><span class="kw ns">::</span><span class="fu"><a href="https://erblast.github.io/parcats//reference/parcats.html">parcats</a></span>(<span class="kw">p</span> <span class="kw">=</span> <span class="no">p</span>,
                 <span class="kw">data_input</span> <span class="kw">=</span> <span class="no">corels_mtcars</span>$<span class="no">alluvial_df</span>,
                 <span class="kw">marginal_histograms</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
                 <span class="kw">hoveron</span> <span class="kw">=</span> <span class="st">'dimension'</span>,
                 <span class="kw">hoverinfo</span> <span class="kw">=</span> <span class="st">'count'</span>,
                 <span class="kw">labelfont</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">11</span>)
)</pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-9-1.png"><!-- --></p>
</div>
<div id="performance-on-training-data" class="section level3">
<h3 class="hasAnchor">
<a href="#performance-on-training-data" class="anchor"></a>Performance on training data</h3>
<p>We can also create a confusion matrix to examine the performance of the rules.</p>
<div class="sourceCode" id="cb12"><pre class="r"><span class="no">conf_matrix</span> <span class="kw">&lt;-</span>
  <span class="no">corels_mtcars</span>$<span class="no">alluvial_df</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">yardstick</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/yardstick/man/conf_mat.html">conf_mat</a></span>(
    <span class="kw">truth</span> <span class="kw">=</span> <span class="st">"am_X1"</span>,
    <span class="kw">estimate</span> <span class="kw">=</span> <span class="st">"corels_label"</span>
  )

<span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span>(<span class="no">conf_matrix</span>, <span class="st">"heatmap"</span>)</pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-10-1.png"><!-- --></p>
</div>
<div id="performance-of-each-rule" class="section level3">
<h3 class="hasAnchor">
<a href="#performance-of-each-rule" class="anchor"></a>Performance of each rule</h3>
<p>A data frame of the performance of each rule is also provided.</p>
<div class="sourceCode" id="cb13"><pre class="r"><span class="no">corels_mtcars</span>$<span class="no">rule_performance_df</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">rule_perc_correct</span> <span class="kw">=</span> <span class="kw pkg">formattable</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/formattable/man/color_tile.html">color_tile</a></span>(<span class="st">"white"</span>, <span class="st">"orange"</span>)(<span class="no">rule_perc_correct</span>)) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">rule_fire_count</span> <span class="kw">=</span> <span class="kw pkg">formattable</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/formattable/man/color_tile.html">color_tile</a></span>(<span class="st">"white"</span>, <span class="st">"lightblue"</span>)(<span class="no">rule_fire_count</span>)) <span class="kw">%&gt;%</span>
  <span class="kw pkg">kableExtra</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/reexports.html">kable</a></span>(<span class="kw">escape</span> <span class="kw">=</span> <span class="no">F</span>,
                   <span class="kw">caption</span> <span class="kw">=</span> <span class="st">"Corels Performance for each rule in order"</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">kableExtra</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span>(<span class="st">"hover"</span>, <span class="kw">full_width</span> <span class="kw">=</span> <span class="no">F</span>)</pre></div>
<table class="table table table-hover">
<caption>
<p>Corels Performance for each rule in order</p>
</caption>
<thead><tr>
<th style="text-align:left;">
<p>rule</p>
</th>
<th style="text-align:left;">
<p>rule_fire_count</p>
</th>
<th style="text-align:right;">
<p>rule_correct</p>
</th>
<th style="text-align:left;">
<p>rule_perc_correct</p>
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
<p>gear_X3</p>
</td>
<td style="text-align:left;">
<p><span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #add8e6">15</span></p>
</td>
<td style="text-align:right;">
<p>15</p>
</td>
<td style="text-align:left;">
<p><span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffa500">100</span></p>
</td>
</tr>
<tr>
<td style="text-align:left;">
<p>wt_bin1</p>
</td>
<td style="text-align:left;">
<p><span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #eef7fa">7</span></p>
</td>
<td style="text-align:right;">
<p>7</p>
</td>
<td style="text-align:left;">
<p><span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffa500">100</span></p>
</td>
</tr>
<tr>
<td style="text-align:left;">
<p>vs_X0</p>
</td>
<td style="text-align:left;">
<p><span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffffff">5</span></p>
</td>
<td style="text-align:right;">
<p>5</p>
</td>
<td style="text-align:left;">
<p><span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffa500">100</span></p>
</td>
</tr>
<tr>
<td style="text-align:left;">
<p>else</p>
</td>
<td style="text-align:left;">
<p><span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffffff">5</span></p>
</td>
<td style="text-align:right;">
<p>4</p>
</td>
<td style="text-align:left;">
<p><span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffffff">80</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<div id="performance-on-new-data" class="section level3">
<h3 class="hasAnchor">
<a href="#performance-on-new-data" class="anchor"></a>Performance on new data</h3>
<p>Use <code><a href="reference/predict_corels.html">tidycorels::predict_corels()</a></code> to apply the Corels rules to a new dataframe (e.g. test data). It also returns the smaller data frame intended for an <a href="https://github.com/erblast/easyalluvial/blob/master/README.md">alluvial</a> plot. Examples can be found in the <a href="https://billster45.github.io/tidycorels/articles/">Articles</a> section.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Bill Cockerill <br><small class="roles"> Maintainer </small>  </li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by Bill Cockerill.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
